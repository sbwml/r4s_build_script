From d4e0c1a849c99da51e6926947b1bd4c4757801e9 Mon Sep 17 00:00:00 2001
From: Zac Bowling <zac@zacbowling.com>
Date: Mon, 5 Jan 2026 13:19:02 -0800
Subject: [PATCH 17/24] wifi: mt76: mt7925: add NULL checks for link pointers
 in sta_add and conf_tx

Add NULL pointer checks for mt792x_sta_to_link() and mt792x_vif_to_link()
results in mt7925_mac_link_sta_add() and mt7925_conf_tx() to prevent
kernel crashes during MLO operations.

The init.c changes from the original patch are not needed as the
mt7925_regd_update() function was refactored in 6.19-rc4.

Signed-off-by: Zac Bowling <zac@zacbowling.com>
---
 mt7925/main.c | 8 ++++++++
 1 file changed, 8 insertions(+)

--- a/mt7925/main.c
+++ b/mt7925/main.c
@@ -879,12 +879,17 @@ static int mt7925_mac_link_sta_add(struc
 
 	msta = (struct mt792x_sta *)link_sta->sta->drv_priv;
 	mlink = mt792x_sta_to_link(msta, link_id);
+	if (!mlink)
+		return -EINVAL;
 
 	idx = mt76_wcid_alloc(dev->mt76.wcid_mask, MT792x_WTBL_STA - 1);
 	if (idx < 0)
 		return -ENOSPC;
 
 	mconf = mt792x_vif_to_link(mvif, link_id);
+	if (!mconf)
+		return -EINVAL;
+
 	mt76_wcid_init(&mlink->wcid, 0);
 	mlink->wcid.sta = 1;
 	mlink->wcid.idx = idx;
@@ -1751,6 +1756,9 @@ mt7925_conf_tx(struct ieee80211_hw *hw,
 		    [IEEE80211_AC_BK] = 1,
 	};
 
+	if (!mconf)
+		return -EINVAL;
+
 	/* firmware uses access class index */
 	mconf->queue_params[mq_to_aci[queue]] = *params;
 
