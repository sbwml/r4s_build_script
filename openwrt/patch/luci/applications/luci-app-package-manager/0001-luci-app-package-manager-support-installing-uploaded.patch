From 6430d15ff19b9885b3aedb5b228b0c3a5652ef29 Mon Sep 17 00:00:00 2001
From: sbwml <admin@cooluc.com>
Date: Wed, 11 Feb 2026 01:11:00 +0800
Subject: [PATCH] luci-app-package-manager: support installing uploaded APK
 without signature

Signed-off-by: sbwml <admin@cooluc.com>
---
 .../htdocs/luci-static/resources/view/package-manager.js     | 2 +-
 .../root/usr/libexec/package-manager-call                    | 5 ++++-
 .../root/usr/share/rpcd/acl.d/luci-app-package-manager.json  | 1 +
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/applications/luci-app-package-manager/htdocs/luci-static/resources/view/package-manager.js b/applications/luci-app-package-manager/htdocs/luci-static/resources/view/package-manager.js
index 8a70b4b..ced8785 100644
--- a/applications/luci-app-package-manager/htdocs/luci-static/resources/view/package-manager.js
+++ b/applications/luci-app-package-manager/htdocs/luci-static/resources/view/package-manager.js
@@ -1084,7 +1084,7 @@ function handleUpload(ev)
 				}, _('Cancel')), ' ',
 				E('div', {
 					'class': 'btn cbi-button-action',
-					'data-command': 'install',
+					'data-command': 'install-upload',
 					'data-package': path,
 					'click': function(ev) {
 						handlePkg(ev).finally(function() {
diff --git a/applications/luci-app-package-manager/root/usr/libexec/package-manager-call b/applications/luci-app-package-manager/root/usr/libexec/package-manager-call
index 3a41757..7fa58f9 100755
--- a/applications/luci-app-package-manager/root/usr/libexec/package-manager-call
+++ b/applications/luci-app-package-manager/root/usr/libexec/package-manager-call
@@ -27,7 +27,7 @@ case "$action" in
 			find "${lists_dir:-/usr/lib/opkg/lists}" -type f '!' -name '*.sig' | xargs -r gzip -cd
 		fi
 	;;
-	install|update|upgrade|remove)
+	install|install-upload|update|upgrade|remove)
 		(
 			cmd="$ipkg_bin"
 
@@ -37,6 +37,9 @@ case "$action" in
 					install)
 						action="add"
 					;;
+					install-upload)
+						action="add --allow-untrusted"
+					;;
 					update)
 						action="update"
 					;;
diff --git a/applications/luci-app-package-manager/root/usr/share/rpcd/acl.d/luci-app-package-manager.json b/applications/luci-app-package-manager/root/usr/share/rpcd/acl.d/luci-app-package-manager.json
index 8d55186..31eb0b6 100644
--- a/applications/luci-app-package-manager/root/usr/share/rpcd/acl.d/luci-app-package-manager.json
+++ b/applications/luci-app-package-manager/root/usr/share/rpcd/acl.d/luci-app-package-manager.json
@@ -20,6 +20,7 @@
 			"file": {
 				"/usr/libexec/package-manager-call install": [ "exec" ],
 				"/usr/libexec/package-manager-call install *": [ "exec" ],
+				"/usr/libexec/package-manager-call install-upload": [ "exec" ],
 				"/usr/libexec/package-manager-call remove *": [ "exec" ],
 				"/usr/libexec/package-manager-call update": [ "exec" ],
 				"/usr/libexec/package-manager-call upgrade": [ "exec" ],
-- 
2.43.5

